!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Rembrandt=e():t.Rembrandt=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){(function(e){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(1),u=(i(a),n(2)),s=i(u),c=n(3),f=i(c),l=n(4),h=i(l),d=n(5),m=i(d),p=n(6),g=i(p),v=n(7),_=i(v);e.Buffer=function(){};var y=function(){function t(e){r(this,t),this._imageA=null,this._imageB=null,this._options=s["default"].defaults(e,{imageA:null,imageB:null,thresholdType:t.THRESHOLD_PERCENT,maxThreshold:.01,maxDelta:20,renderComposition:!1,compositionMaskColor:g["default"].RED,maxOffset:0}),this._validateOptions()}return o(t,[{key:"compare",value:function(){var t=this;return this._loadImages().then(function(){var e=new _["default"](t._imageA,t._imageB,t._options);return e.compare()})}},{key:"_validateOptions",value:function(){var e=this,n=function(t){var n=e._options[t];if(!("string"==typeof n||Buffer.isBuffer(n)||n instanceof m["default"]))throw new Error("Option `"+t+"` must either be a String, Buffer or Rembrandt.Image.")};n("imageA"),n("imageB");var i=this._options,r=i.thresholdType,o=i.threshold,a=i.maxDelta,u=[t.THRESHOLD_PERCENT,t.THRESHOLD_PIXELS];if(u.indexOf(r)===-1)throw new Error("`thresholdType` must be either Rembrandt.THRESHOLD_PERCENT or Rembrandt.THRESHOLD_PIXELS");if(r===t.THRESHOLD_PERCENT&&o<0||o>1)throw new Error("`threshold` must be between 0 and 1");if(a<0||a>255)throw new Error("`maxDelta` must be between 0 and 255")}},{key:"_loadImages",value:function(){var t=this;return this._loadImage(this._options.imageA).then(function(e){return t._imageA=e,t._loadImage(t._options.imageB)}).then(function(e){t._imageB=e})}},{key:"_loadImage",value:function(t){return new f["default"](function(e,n){return t instanceof m["default"]?e(t):t instanceof Buffer?e(m["default"].fromBuffer(t)):void!function(){var n=s["default"].createImage();n.addEventListener("load",function(){e(m["default"].fromImage(n))}),n.crossOrigin="Anonymous",n.src=t}()})}}],[{key:"createImage",value:function(t,e){return new m["default"](t,e)}}]),t}();y.Image=m["default"],y.Color=g["default"],y.version=n(9).version;for(var b in h["default"])y[b]=h["default"][b];t.exports=y}).call(e,function(){return this}())},function(t,e){"use strict"},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){i(this,t)}return r(t,null,[{key:"defaults",value:function(t){var e={};for(var n in t)e[n]=t[n];for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];for(var a=0;a<r.length;a++){var u=r[a];for(var s in u)"undefined"==typeof e[s]&&(e[s]=u[s])}return e}},{key:"createCanvas",value:function(t,e){var n=void 0;return n=document.createElement("canvas"),n.width=t,n.height=e,n}},{key:"createImage",value:function(){var t=void 0;return t=new window.Image}}]),t}();e["default"]=o},function(t,e,n){var i;(function(r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};/*!
	 * Native Promise Only
	 * v0.8.0-a (c) Kyle Simpson
	 * MIT License: http://getify.mit-license.org
	 * @license
	 */
!function(r,o,a){o[r]=o[r]||a(),"undefined"!=typeof t&&t.exports?t.exports=o[r]:(i=function(){return o[r]}.call(e,n,e,t),!(void 0!==i&&(t.exports=i)))}("Promise","undefined"!=typeof r?r:void 0,function(){function t(t,e){d.add(t,e),h||(h=p(d.drain))}function e(t){var e,n="undefined"==typeof t?"undefined":o(t);return null==t||"object"!=n&&"function"!=n||(e=t.then),"function"==typeof e&&e}function n(){for(var t=0;t<this.chain.length;t++)i(this,1===this.state?this.chain[t].success:this.chain[t].failure,this.chain[t]);this.chain.length=0}function i(t,n,i){var r,o;try{n===!1?i.reject(t.msg):(r=n===!0?t.msg:n.call(void 0,t.msg),r===i.promise?i.reject(TypeError("Promise-chain cycle")):(o=e(r))?o.call(r,i.resolve,i.reject):i.resolve(r))}catch(a){i.reject(a)}}function r(i){var o,u=this;if(!u.triggered){u.triggered=!0,u.def&&(u=u.def);try{(o=e(i))?t(function(){var t=new s(u);try{o.call(i,function(){r.apply(t,arguments)},function(){a.apply(t,arguments)})}catch(e){a.call(t,e)}}):(u.msg=i,u.state=1,u.chain.length>0&&t(n,u))}catch(c){a.call(new s(u),c)}}}function a(e){var i=this;i.triggered||(i.triggered=!0,i.def&&(i=i.def),i.msg=e,i.state=2,i.chain.length>0&&t(n,i))}function u(t,e,n,i){for(var r=0;r<e.length;r++)!function(r){t.resolve(e[r]).then(function(t){n(r,t)},i)}(r)}function s(t){this.def=t,this.triggered=!1}function c(t){this.promise=t,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function f(e){if("function"!=typeof e)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var i=new c(this);this.then=function(e,r){var o={success:"function"!=typeof e||e,failure:"function"==typeof r&&r};return o.promise=new this.constructor(function(t,e){if("function"!=typeof t||"function"!=typeof e)throw TypeError("Not a function");o.resolve=t,o.reject=e}),i.chain.push(o),0!==i.state&&t(n,i),o.promise},this["catch"]=function(t){return this.then(void 0,t)};try{e.call(void 0,function(t){r.call(i,t)},function(t){a.call(i,t)})}catch(o){a.call(i,o)}}var l,h,d,m=Object.prototype.toString,p="undefined"!=typeof setImmediate?function(t){return setImmediate(t)}:setTimeout;try{Object.defineProperty({},"x",{}),l=function(t,e,n,i){return Object.defineProperty(t,e,{value:n,writable:!0,configurable:i!==!1})}}catch(g){l=function(t,e,n){return t[e]=n,t}}d=function(){function t(t,e){this.fn=t,this.self=e,this.next=void 0}var e,n,i;return{add:function(r,o){i=new t(r,o),n?n.next=i:e=i,n=i,i=void 0},drain:function(){var t=e;for(e=n=h=void 0;t;)t.fn.call(t.self),t=t.next}}}();var v=l({},"constructor",f,!1);return f.prototype=v,l(v,"__NPO__",0,!1),l(f,"resolve",function(t){var e=this;return t&&"object"==("undefined"==typeof t?"undefined":o(t))&&1===t.__NPO__?t:new e(function(e,n){if("function"!=typeof e||"function"!=typeof n)throw TypeError("Not a function");e(t)})}),l(f,"reject",function(t){return new this(function(e,n){if("function"!=typeof e||"function"!=typeof n)throw TypeError("Not a function");n(t)})}),l(f,"all",function(t){var e=this;return"[object Array]"!=m.call(t)?e.reject(TypeError("Not an array")):0===t.length?e.resolve([]):new e(function(n,i){if("function"!=typeof n||"function"!=typeof i)throw TypeError("Not a function");var r=t.length,o=Array(r),a=0;u(e,t,function(t,e){o[t]=e,++a===r&&n(o)},i)})}),l(f,"race",function(t){var e=this;return"[object Array]"!=m.call(t)?e.reject(TypeError("Not an array")):new e(function(n,i){if("function"!=typeof n||"function"!=typeof i)throw TypeError("Not a function");u(e,t,function(t,e){n(e)},i)})}),f})}).call(e,function(){return this}())},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]={THRESHOLD_PERCENT:0,THRESHOLD_PIXELS:1}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(2),u=i(a),s=n(6),c=i(s),f=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r(this,t),this.width=e,this.height=n,this._canvas=u["default"].createCanvas(e,n),this._context=this._canvas.getContext("2d"),this._image=i,i?this._drawImage(this._image):this._imageData=this._context.createImageData(e,n)}return o(t,[{key:"setColorAt",value:function(t,e,n){var i=4*(e*this.width+t);this._imageData.data[i]=255*n.r|0,this._imageData.data[i+1]=255*n.g|0,this._imageData.data[i+2]=255*n.b|0,this._imageData.data[i+3]=255*n.a|0}},{key:"getColorAt",value:function(t,e){var n=4*(this.width*e+t),i=this._imageData.data[n],r=this._imageData.data[n+1],o=this._imageData.data[n+2],a=this._imageData.data[n+3];return new c["default"](i,r,o,a)}},{key:"getImageData",value:function(){return this._imageData}},{key:"setImageData",value:function(t){this._imageData.data.set(t.data)}},{key:"clone",value:function(){var e=new t(this.width,this.height);return e.setImageData(this._imageData),e}},{key:"persist",value:function(){this._context.putImageData(this._imageData,0,0)}},{key:"toBuffer",value:function(){return this.persist(),this._canvas.toBuffer()}},{key:"_drawImage",value:function(t){this._context.drawImage(t,0,0),this._imageData=this._context.getImageData(0,0,this.width,this.height)}},{key:"canvas",get:function(){return this._canvas}},{key:"imageData",get:function(){return this._imageData}}],[{key:"fromBuffer",value:function(e){var n=u["default"].createImage();return n.src=e,new t(n.width,n.height,n)}},{key:"fromImage",value:function(e){return new t(e.width,e.height,e)}}]),t}();e["default"]=f},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e,i,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;n(this,t),this.r=e,this.g=i,this.b=r,this.a=o}return i(t,[{key:"clone",value:function(){return new t(this.r,this.g,this.b,this.a)}},{key:"equals",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}},{key:"toString",value:function(){return"Color("+this.r+", "+this.g+", "+this.b+", "+this.a+")"}}],[{key:"TRANSPARENT",get:function(){return new t(0,0,0,0)}},{key:"WHITE",get:function(){return new t(1,1,1,1)}},{key:"BLACK",get:function(){return new t(0,0,0,1)}},{key:"RED",get:function(){return new t(1,0,0,1)}}]),t}();e["default"]=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(2),u=i(a),s=n(3),c=i(s),f=n(4),l=i(f),h=n(5),d=i(h),m=n(6),p=i(m),g=n(8),v=i(g),_=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,t),this._imageA=e,this._imageB=n,this._prepareImages(),this._options=u["default"].defaults(i,{maxDelta:20,thresholdType:l["default"].THRESHOLD_PERCENT,maxThreshold:.01,renderComposition:!1,compositionMaskColor:p["default"].RED,maxOffset:0}),this._options.renderComposition&&(this._compositionImage=new v["default"](this._imageA,this._imageB))}return o(t,[{key:"compare",value:function(){var t=this;return new c["default"](function(e,n){var i=Math.min(t._imageA.width,t._imageB.width),r=Math.min(t._imageA.height,t._imageB.height),o=0,a=void 0,u=void 0;for(a=0;a<i;a++)for(u=0;u<r;u++){var s=t._comparePosition(a,u);s||(t._options.renderComposition&&t._compositionImage.setColorAt(a,u,t._options.compositionMaskColor),o++)}var c=o;if(t._options.thresholdType===l["default"].THRESHOLD_PERCENT){var f=i*r;c/=f}var h=c<=t._options.maxThreshold;t._options.renderComposition?t._compositionImage.render().then(function(t){e({differences:o,threshold:c,passed:h,compositionImage:t})}):e({differences:o,threshold:c,passed:h})})}},{key:"_prepareImages",value:function(){var t=Math.max(this._imageA.width,this._imageB.width),e=Math.max(this._imageB.height,this._imageB.height);this._imageA=this._ensureImageDimensions(this._imageA,t,e),this._imageB=this._ensureImageDimensions(this._imageB,t,e)}},{key:"_ensureImageDimensions",value:function(t,e,n){if(t.width===e&&t.height===t.height)return t;t.persist();var i=new d["default"](e,n,t.canvas);return i}},{key:"_calculateColorDelta",value:function(t,e){var n=0;return n+=Math.pow(t.r-e.r,2),n+=Math.pow(t.g-e.g,2),n+=Math.pow(t.b-e.b,2),n+=Math.pow(t.a-e.a,2),Math.sqrt(255*n)}},{key:"_comparePosition",value:function(t,e){var n=this._options,i=n.maxDelta,r=n.maxOffset,o=this._imageA.getColorAt(t,e),a=this._imageB.getColorAt(t,e),u=this._calculateColorDelta(o,a);if(u<i)return!0;if(0===r)return!1;var s=this._imageA,c=s.width,f=s.height,l=Math.max(0,t-r),h=Math.min(c-1,t+r),d=Math.max(0,e-r),m=Math.min(f-1,e+r),p=void 0,g=void 0;for(p=l;p<=h;p++)for(g=d;g<=m;g++)if(p!==t&&g!==e){var v=this._imageA.getColorAt(p,g),_=this._calculateColorDelta(o,v),y=this._imageB.getColorAt(p,g),b=this._calculateColorDelta(o,y);if(Math.abs(b-_)<i&&_>i)return!0}return!1}}]),t}();e["default"]=_},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(3),c=i(s),f=n(2),l=i(f),h=n(5),d=i(h),m=function(t){function e(t,n){r(this,e),t.persist(),n.persist();var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.width,t.height,t.canvas));return i._imageA=t,i._imageB=n,i}return a(e,t),u(e,[{key:"render",value:function(){var t=this;return new c["default"](function(e,n){t._canvas.width=3*t._imageA.width,t._context.drawImage(t._imageA.canvas,0,0),t._context.drawImage(t._imageB.canvas,2*t._imageA.width,0),t._context.putImageData(t._imageData,t._imageA.width,0),!function(){var n=l["default"].createImage();n.addEventListener("load",function(){e(n)}),n.src=t._canvas.toDataURL("image/png")}()})}}]),e}(d["default"]);e["default"]=m},function(t,e){"use strict";t.exports={name:"rembrandt",version:"0.0.8",description:"Client- and server-side image comparison library",main:"build/node.js",repository:{url:"git://github.com/imgly/rembrandt.git",type:"git"},scripts:{test:"node_modules/.bin/mocha --require test/support test/*.test.js",build:"node_modules/.bin/webpack"},author:"PhotoEditorSDK.com <contact@photoeditorsdk.com>",license:"MIT",dependencies:{canvas:"^1.6.0"},devDependencies:{"babel-core":"^6.17.0","babel-loader":"^6.2.5","babel-preset-es2015":"^6.16.0","babel-register":"^6.16.3",chai:"^3.5.0","chai-as-promised":"^6.0.0","json-loader":"^0.5.4",mocha:"^3.1.2","preprocess-loader":"^0.2.0",should:"^11.1.1","standard-loader":"^5.0.0",webpack:"^1.13.2"}}}])});